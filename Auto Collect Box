-- Tạo GUI chính và các thành phần
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local ToggleButton = Instance.new("ImageButton")
local TitleLabel = Instance.new("TextLabel") -- Thêm tiêu đề
local ActivateButton = Instance.new("TextButton")
local UICorner = Instance.new("UICorner")

-- Cấu hình ScreenGui
ScreenGui.Name = "AutoTeleportGUI"
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false -- Không bị mất khi người chơi chết

-- Cấu hình MainFrame (GUI chính)
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BorderSizePixel = 0
MainFrame.Size = UDim2.new(0, 240, 0, 140)
MainFrame.Position = UDim2.new(0.5, -120, 0.5, -70)
MainFrame.Visible = true

-- Làm tròn MainFrame
UICorner.Parent = MainFrame
UICorner.CornerRadius = UDim.new(0, 10)

-- Cấu hình TitleLabel (Tiêu đề GUI)
TitleLabel.Name = "TitleLabel"
TitleLabel.Parent = MainFrame
TitleLabel.BackgroundTransparency = 1
TitleLabel.Size = UDim2.new(1, 0, 0, 30)
TitleLabel.Position = UDim2.new(0, 0, 0, 5)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 16
TitleLabel.Text = "zam2109 HUB | Collect Box"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Cấu hình ToggleButton (Nút bật/tắt GUI chính)
ToggleButton.Name = "ToggleButton"
ToggleButton.Parent = ScreenGui
ToggleButton.BackgroundTransparency = 1
ToggleButton.Size = UDim2.new(0, 60, 0, 60)
ToggleButton.Position = UDim2.new(0, 20, 0, 20)
ToggleButton.Image = "rbxassetid://82145301120414" -- Thay thế bằng ID ảnh của bạn
ToggleButton.ScaleType = Enum.ScaleType.Fit

-- Làm tròn ToggleButton
local ToggleUICorner = Instance.new("UICorner", ToggleButton)
ToggleUICorner.CornerRadius = UDim.new(1, 0)

-- Cấu hình ActivateButton (Nút bật/tắt tự động)
ActivateButton.Name = "ActivateButton"
ActivateButton.Parent = MainFrame
ActivateButton.BackgroundColor3 = Color3.fromRGB(70, 200, 70)
ActivateButton.BorderSizePixel = 0
ActivateButton.Size = UDim2.new(0, 200, 0, 50)
ActivateButton.Position = UDim2.new(0, 20, 0, 70)
ActivateButton.Text = "Collecting!"
ActivateButton.Font = Enum.Font.GothamBold
ActivateButton.TextSize = 16
ActivateButton.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Làm tròn ActivateButton
local ActivateUICorner = Instance.new("UICorner", ActivateButton)
ActivateUICorner.CornerRadius = UDim.new(0, 10)

-- Biến trạng thái
local autoActive = false
local guiVisible = true
local dragStart, startPos, dragging = nil, nil, false

-- Chức năng kéo GUI
local function enableDragging(frame)
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)

    frame.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

-- Bật tính năng kéo cho MainFrame và ToggleButton
enableDragging(MainFrame)
enableDragging(ToggleButton)

-- Chức năng ẩn/hiện GUI chính
ToggleButton.MouseButton1Click:Connect(function()
    guiVisible = not guiVisible
    MainFrame.Visible = guiVisible
end)

-- Chức năng teleport và click
local function autoTeleportAndClick()
    -- Tìm tất cả các MeshPart có tên "Box"
    local boxes = {}
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("MeshPart") and obj.Name == "Box" then
            table.insert(boxes, obj)
        end
    end

    if #boxes == 0 then
        warn("No 'Box' MeshParts found in Workspace.")
        return
    end

    local currentIndex = 1
    local holdDuration = 2 -- Thời gian giữ click/kích hoạt (2 giây)

    -- Hàm giữ click hoặc kích hoạt
    local function holdClickOrActivate(part)
        local clickDetector = part:FindFirstChildOfClass("ClickDetector")
        if clickDetector then
            local startTime = tick()
            while tick() - startTime < holdDuration and autoActive do
                fireclickdetector(clickDetector)
                wait(0.1)
            end
        end

        local proximityPrompt = part:FindFirstChildOfClass("ProximityPrompt")
        if proximityPrompt then
            local startTime = tick()
            while tick() - startTime < holdDuration and autoActive do
                fireproximityprompt(proximityPrompt, Enum.ProximityPromptInputType.Keyboard)
                wait(0.1)
            end
        end
    end

    -- Vòng lặp chính
    while autoActive do
        local currentBox = boxes[currentIndex]

        -- Kiểm tra nhân vật và teleport
        local player = game.Players.LocalPlayer
        if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local humanoidRootPart = player.Character.HumanoidRootPart
            humanoidRootPart.CFrame = currentBox.CFrame + Vector3.new(0, 3, 0)
        else
            warn("Character or HumanoidRootPart not found. Skipping teleport.")
        end

        -- Click hoặc kích hoạt
        holdClickOrActivate(currentBox)

        -- Chuyển sang Box tiếp theo
        currentIndex = (currentIndex % #boxes) + 1
        wait(2) -- Chờ 2 giây
    end
end

-- Kích hoạt/Tắt chức năng tự động
ActivateButton.MouseButton1Click:Connect(function()
    autoActive = not autoActive
    if autoActive then
        ActivateButton.Text = "Stop Collecting"
        ActivateButton.BackgroundColor3 = Color3.fromRGB(200, 70, 70)
        coroutine.wrap(autoTeleportAndClick)()
    else
        ActivateButton.Text = "Collecting!"
        ActivateButton.BackgroundColor3 = Color3.fromRGB(70, 200, 70)
    end
end)
